const map = `..........................#.#........................................#..........................................#.............#...
....................#...............................#.......#...............................#..........................#...#......
.....#.......#...................................................#..#....................##.........#...#...........#.....#..#.#..
............#...#....#..............##...#.#....#........................#...................................................#....
....#......##........................................................................#..#..##...................##.........#......
.............##.........#..##..............#...............#....................#..................#......#...................#...
...........#.....................#.......#.................#....#.#..............#...........#.........................#..........
.#............#..............................................................#........#................#........#.................
..........................#..#.......................................................#.........#..................................
.........#....#................#...........#...................##............#..........#.........................................
....#...................................#....#.........#..........#.......................#..............................#........
.............................#.....##.............................................................#..#...........................#
....#................#...#.#..........#.#....#..................#..........#......#.............................#.................
......................#............#......................................##................#..........#..#.............#.........
..#........#............#.....###....##...........................#..............................#.....#..........................
.....#...........#..#.........#...................#.#.................#........#............#.....#........#......................
..........................................................................................................................#.......
..#...................#.....................................................................#....................#................
...............#............................#....#..........#...................#............#...............#..#.................
................#...........................#...........................................#.........................#...............
..........#.......#.........................##.................................................#...................##..#..........
.#.........#...#..#............................................#........................#.......................................#.
........#...........###..................#...........#..............#.....................#................#......................
.............#....#............................#.#..............................#..#................................#.............
...#.....#..........#...........#..................................................#........#...........#..#..........##.....#....
...............................................................................#...................#........................##....
......#.#...........................#.................#.................................................................#.........
..................................#............................................................................#.#................
........................#.......#.....#..........#..#.............##.................#..............#............##...............
......#........................#........................................#......#..................................................
...............##.......#..............................................................................................#..........
....#...................................................................................#.........#..........#..............#.....
.....#.............#.........................#.........#........#................#.#.........................#..........#.........
.............#......##...........#................#...#.#.....#......................................#..........#.................
...........................#............#................#................#...........................#.....#.....................
.......#.................#..#..............#................................#....#........#.......#.............#....#....##......
........................................................#........................................................................#
.................#.........................................#.......#.......#......#...#.#.................##......................
..........#............#..............................................#........................................#..........#..#....
..............#......................................................#......#................................#....................
...#........#.............#.................#......#.......................#..............................##........#.............
.....................#............................................................#............#...............................#..
......#.....#..............................................................#...............#...#..................................
.......................................#..#.......#...#..............#.................................................#..........
...................................................................................................#........................#.....
....#.....#.......................................................#.....#......#...................#............#.................
..............#....#.....................#........................................##....#...#.....................................
.....#...............................................................#............#............................#..................
........................#..........................#..............................................................................
#..............#...........................................................................#......................................
...................................#...#....................................................................#.....................
................#......#.........#.................#...........................#..................................................
......#...#................#...............#..................................................#...................................
.......................#.............#..#....................#............#.......................................................
.....................#.#.....................................#................................##.............#.#..#..............#
.....................................#...#...........................#....................................................##...#..
.................#..#............#.............................#..#................................................##.............
...#...........................................#.................................................#.............#.............##...
..................#....#....#.#..........................#.............#................#............................#............
.........................#................#.#..#.#............^.........................................................#.........
.....#...............#............................................................................................................
.#.......................................................................................#...............#....#.............#.....
......#................................#............#............................................................#................
.#.....................#..............#.............#.......................#.....#....#.#.#...................#....#.............
..................................................................#........#............................#..#.#...............#....
.#.....................#......#........#.......#.................#.......................#..#.....................................
..............#..#..#.............................................#....................#......#...................................
.................##.#............................##..#...............................................................#....#.......
...........#..#........................#.#..........#.................##.....#...#.........................#.#...#............#...
.....................#..........#..#..............................................................................................
.......#...............................#..#.........#.....................................#......#...................#............
..............................##.#........#.......#..#.....#......................................................................
..................#......................#.....................................###...#............................##..............
...................................#...................................#...........................#....##..#.....................
.....................#.....#.#.........#.........................#.....#.......#..........#.......................#...............
...........#..................................................................................................#...................
......#............................#.............................#..........................................#.....##..............
...........................#...........................................................#.............................#..........#.
..........................................#..........................................#......#...............#.....................
..............##.........#........................................................................................................
.....................#............#..#......#..#......................................................................#...........
........#.........#.....................#.................................#...#.#....#....#......................#.#..............
......#...........#............................................................#..............#......................#............
.....#.....................#.....#.........#.............................#....#............................#......................
..#..............................................................................................................#...#............
..............#.......................#........#............................................#.......................#.............
........................................#....................................................................................##...
.......#..#.......#.................#.#.................#...........#............#........#.#.........#...........#.#..........#..
.....##.......................#.........................#.........................#...........#.........#.....#...........#.......
..........................#.....................#...............................#.............................#...................
.....#..........#.............#...#..........................#.#...................#...........................#......#...........
......................................#.......#.........#......................................#..................................
......#...#....................#................#...#.......#.............#............#...........#.....#........................
........................................#............#......................................................#............#........
..#.......#....#..........................................................................#......................##..#.......#....
................#...................................................#..........................................#..................
...........#........................................................................................#.............................
..................#........................................#.....#...........................#..................#.................
........#.......#.....#...........#.......................................................#.........#.............................
.............#.....#.#............................#...................................................................#...........
...............#...................................#...........................#.............#..#..................#..##..........
.#...............................#....#.....................#...................................#...................#...#.........
..................#..#.#..................................................................................................#.......
.........#.....#...#.........#........#...........................................#..................#.#.#......#.................
.........#......#.......................#........#.............................#...#................#...........................#.
...#.........................................................................................##........................#..........
.....................................#...........................................................#.#...#......#...............#...
#.....................#.........#.................................................#.....................................#.........
............##.............................#...............................................#......................................
.#.................#........................#.................................................................#.....#.............
.....#.......................#......................#.................#....#....................................................#.
.............................#..................................................................#.#...............................
........#.......#.....##..........................................#...................#.........#...........#...#...#...#.........
..........#.#...#.....................#............................................................##.........##..................
...................#..............##.....#...........#.#.......#................................................#...............#.
............................................................#....#.............#....##.......#...#...#................#...........
......#...............................#.........#...................#....#..............#.................#.......................
....................................#.....................#....#....#.................#...............#...........................
.................................#.............#.#...................................#..............#...#.....#.............#.....
......................#..................#.............#.................#................................................#.......
.....................##.......................#.............#...#........#..........#.....#............................##...#.....
..........................#.....................#...........#.....................................................#...............
................#.....................................................................................................#...........
........#......#.......................#....................................#................................#....................
.....................................#............................................................................................
........#..........#.........#.#................##................#...#..........................#.........#......##.......#......
.......#...................#................................#..#.......................#..............................#...........
............#.....................................#......#........................#..........#.............................#......
..#...........#...........#...................................#............#...#.....#......................................#.....
................................................................#...........#.......##.......#..........#............#............`.trim().split("\n").map(row => row.split(""));
//console.log(map);
// Find the guard's initial position and direction
let guardPos = null;
let direction = 'up';
for (let row = 0; row < map.length; row++) {
  for (let col = 0; col < map[row].length; col++) {
    if (map[row][col] === '^') {
      guardPos = { row, col };
      direction = 'up';
      break;
    }
  }
  if (guardPos) break;
}

// Directions in the order of right turns
const directions = ['up', 'right', 'down', 'left'];
const directionMoves = {
  up: { row: -1, col: 0 },
  right: { row: 0, col: 1 },
  down: { row: 1, col: 0 },
  left: { row: 0, col: -1 }
};

// Track visited positions
const visited = new Set();
visited.add(`${guardPos.row},${guardPos.col}`);

// Function to check if next position is valid
const isValidMove = (row, col) => {
  return row >= 0 && row < map.length && col >= 0 && col < map[0].length && map[row][col] !== '#';
};

// Start moving the guard
while (true) {
  const move = directionMoves[direction];
  const nextRow = guardPos.row + move.row;
  const nextCol = guardPos.col + move.col;

  // Stop if the guard is about to leave the map bounds
  if (
    nextRow < 0 ||
    nextRow >= map.length ||
    nextCol < 0 ||
    nextCol >= map[0].length
  ) {
    break;
  }

  // If there's an obstacle, turn right
  if (!isValidMove(nextRow, nextCol)) {
    const currentDirectionIndex = directions.indexOf(direction);
    direction = directions[(currentDirectionIndex + 1) % 4];
  } else {
    // Move forward
    guardPos = { row: nextRow, col: nextCol };
    visited.add(`${guardPos.row},${guardPos.col}`);
  }
}

// Mark visited positions on the map
for (let pos of visited) {
  const [row, col] = pos.split(',').map(Number);
  if (map[row][col] === '.') {
    map[row][col] = 'X';
  }
}

// Output the map with visited positions
for (let row of map) {
  console.log(row.join(''));
}

// Output the number of distinct positions visited
console.log('Distinct positions visited:', visited.size);
